<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#0a2a43"/>
  <title>Profile Â· Whylee</title>
  <link rel="manifest" href="/site.webmanifest?v=7000"/>
  <link rel="icon" href="/media/icons/favicon.svg" type="image/svg+xml"/>
  <link rel="stylesheet" href="/css/style.css?v=7000"/>
</head>
<body class="theme-dark">
  <header class="app-header">
    <a class="brand" href="/"><img src="/media/icons/app-icon.svg" alt="" class="brand-icon"/>Whylee</a>
    <nav class="top-nav">
      <a href="/achievements.html" class="top-link">Badges</a>
      <a href="/pro.html" class="top-link">Pro</a>
    </nav>
  </header>

  <main class="app-shell">
    <section class="card">
      <h1>Your Profile</h1>
      <div class="grid-2 gap">
        <div class="card-soft">
          <h2>Avatar</h2>
          <img id="avatarPreview" class="avatar-lg" src="/media/avatars/fox-default.png" alt="Selected avatar" />
          <div class="row wrap">
            <button class="chip" data-avatar="fox-default.png">Fox</button>
            <button class="chip" data-avatar="fox-happy.png">Happy</button>
            <button class="chip" data-avatar="fox-focused.png">Focused</button>
            <button class="chip" data-avatar="fox-sad.png">Sad</button>
            <button class="chip pro" data-avatar="owl-pro.png">Owl (Pro)</button>
            <button class="chip pro" data-avatar="panda-pro.png">Panda (Pro)</button>
            <button class="chip pro" data-avatar="cat-pro.png">Cat (Pro)</button>
            <button class="chip pro" data-avatar="monkey-pro.png">Monkey (Pro)</button>
          </div>
        </div>

        <div class="card-soft">
          <h2>Stats</h2>
          <div class="kv">
            <span class="muted">Level</span><span id="pLevel">1</span>
            <span class="muted">XP</span><span id="pXP">0</span>
            <span class="muted">Daily Streak</span><span id="pStreak">0</span>
            <span class="muted">Perfects</span><span id="pPerfects">0</span>
          </div>
          <div class="progress">
            <i id="pXPBar" style="width:0%"></i>
          </div>
        </div>
      </div>
      <div class="row gap">
        <button id="btnExport" class="btn secondary">Export Data</button>
        <button id="btnImport" class="btn secondary">Import Data</button>
        <input id="fileImport" type="file" accept="application/json" hidden/>
        <span class="spacer"></span>
        <a class="btn ghost" href="/achievements.html">View Badges</a>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <nav class="tabs">
      <a href="/#/home">Home</a>
      <a href="/profile.html" class="active">Profile</a>
      <a href="/achievements.html">Badges</a>
    </nav>
  </footer>

  <script>
    const el = (s)=>document.querySelector(s);
    document.addEventListener('click', (e)=>{
      const b = e.target.closest('.chip[data-avatar]');
      if (!b) return;
      const file = b.dataset.avatar;
      el('#avatarPreview').src = '/media/avatars/' + file;
      try{ localStorage.setItem('whylee:avatar', file); }catch(_){}
    });
    el('#btnExport')?.addEventListener('click', ()=>{
      const payload = {
        avatar: localStorage.getItem('whylee:avatar') || 'fox-default.png',
        tasks: JSON.parse(localStorage.getItem('whylee:tasks')||'[]')
      };
      const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
      const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:'whylee-profile.json'});
      a.click(); URL.revokeObjectURL(a.href);
    });
    el('#btnImport')?.addEventListener('click', ()=> el('#fileImport').click());
    el('#fileImport')?.addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return;
      const text = await f.text();
      try{
        const data = JSON.parse(text);
        if (data.avatar) localStorage.setItem('whylee:avatar', data.avatar);
        if (Array.isArray(data.tasks)) localStorage.setItem('whylee:tasks', JSON.stringify(data.tasks));
        location.reload();
      }catch{
        alert('Invalid JSON');
      }
    });
  </script>
  <script src="/js/app.js?v=7000" defer></script>
</body>
</html>
