<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a2a43" />
  <meta name="description" content="Whylee — global leaderboard" />

  <title>Whylee · Leaderboard</title>

  <!-- Brand & Avatars -->
  <link rel="stylesheet" href="/styles/brand.css?v=7005" />
  <link rel="stylesheet" href="/styles/avatar.css?v=7005" />
  <link rel="stylesheet" href="/styles/avatar-badge.css?v=7006" />

  <style>
    /* Page chrome (minimal, dark, cinematic) */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif; margin:0; background:#0A2A43; color:#E9F3FF; }
    .app-header { display:flex; align-items:center; gap:12px; padding:16px 20px; border-bottom:1px solid rgba(233,243,255,.08); }
    .app-header .brand { margin:0; font-size:1.25rem; letter-spacing: .3px; }
    .container { max-width:1100px; margin:0 auto; padding:20px; }

    .toolbar { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin: 8px 0 18px; }
    .pill { padding:8px 12px; border-radius:999px; border:1px solid rgba(233,243,255,.1); background:rgba(255,255,255,.02); }
    .btn { cursor:pointer; padding:10px 14px; border-radius:10px; border:0; color:#061522; background: linear-gradient(135deg, var(--whylee-blue,#11A7FF), #57D1FF); box-shadow:0 8px 28px rgba(17,167,255,.25); }
    .btn.secondary { background:rgba(233,243,255,.06); color:#E9F3FF; box-shadow:none; border:1px solid rgba(233,243,255,.1); }

    /* Grid */
    .leaderboard-grid {
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:16px;
    }
    @media (max-width: 980px) { .leaderboard-grid { grid-template-columns: repeat(8, 1fr); } }
    @media (max-width: 720px) { .leaderboard-grid { grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 480px) { .leaderboard-grid { grid-template-columns: repeat(2, 1fr); } }

    .card {
      grid-column: span 4;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border:1px solid rgba(233,243,255,.08);
      border-radius:16px;
      padding:14px;
      display:flex; align-items:center; gap:12px;
      backdrop-filter: blur(6px);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .card:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,.35); }

    .meta { display:flex; flex-direction:column; gap:4px; min-width:0; }
    .name { font-weight:700; letter-spacing:.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sub { opacity:.8; font-size:.92rem; display:flex; gap:10px; flex-wrap:wrap; }
    .rank {
      margin-left:auto; font-weight:800; font-size:1.1rem; color:#D8FF72;
      text-shadow:0 0 14px rgba(216,255,114,.15);
    }

    /* Tiny strip under cards to show XP % (visual reinforcement) */
    .xp-bar { height:4px; background:rgba(233,243,255,.08); border-radius:99px; overflow:hidden; margin-top:10px; }
    .xp-fill { height:100%; width:0; background: linear-gradient(90deg, #11A7FF, #57D1FF); }

    /* Top-3 glow variants */
    .top-1 { border-color: rgba(255,215,96,.35); box-shadow: 0 0 0 1px rgba(255,215,96,.15) inset; }
    .top-2 { border-color: rgba(200,220,245,.28); box-shadow: 0 0 0 1px rgba(200,220,245,.12) inset; }
    .top-3 { border-color: rgba(216,255,114,.28); box-shadow: 0 0 0 1px rgba(216,255,114,.12) inset; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="app-header">
    <button class="icon btn secondary" onclick="history.back()" aria-label="Back">←</button>
    <h1 class="brand">Leaderboard</h1>
    <div class="pill" id="seasonPill" title="Season">S1 · Daily Brain Bolt</div>
    <div style="margin-left:auto; display:flex; gap:10px;">
      <button class="btn secondary" id="btnRefresh">Refresh</button>
      <button class="btn" onclick="location.href='#/play'">Play</button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <section class="toolbar">
      <div class="pill" id="filterPill">Filter: All</div>
      <div class="pill" id="youPill">You: <span id="youTier">free</span> · Streak <span id="youStreak">0</span></div>
    </section>

    <section id="grid" class="leaderboard-grid" aria-live="polite">
      <!-- Cards injected by JS -->
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="container" style="opacity:.6; font-size:.9em; padding-bottom:24px;">
    <hr class="hr-soft" style="margin:24px 0;">
    <p>&copy; 2025 Whylee · Daily Brain Training</p>
  </footer>

  <!-- Avatar module -->
  <script type="module" src="/scripts/ui/avatar.js?v=7006"></script>

  <!-- Page logic -->
  <script type="module">
    import { renderAvatar } from '/scripts/ui/avatar.js?v=7006';

    import { fetchLeaderboard } from '/scripts/data/fetchLeaderboard.js?v=7006';

// 1) Load static leaderboard
const demo = await fetchLeaderboard();

    // 2) Render cards
    const grid = document.getElementById('grid');
    renderGrid(demo);

    // 3) Update "You" pill from local
    const you = JSON.parse(localStorage.getItem('wl_user') || '{}');
    const youTier = (you.tier || 'free').toLowerCase();
    const youStreak = Number(localStorage.getItem('wl_streak') || '0');
    document.getElementById('youTier').textContent = youTier;
    document.getElementById('youStreak').textContent = youStreak;

    // Optional: Refresh button (re-renders with same data here)
    document.getElementById('btnRefresh').addEventListener('click', () => renderGrid(demo));

    // ---- Helpers ----
    function renderGrid(rows) {
      grid.innerHTML = '';
      rows.forEach((p, idx) => {
        const card = document.createElement('article');
        card.className = 'card' + (p.rank === 1 ? ' top-1' : p.rank === 2 ? ' top-2' : p.rank === 3 ? ' top-3' : '');

        // Avatar wrap
        const wrap = document.createElement('div');
        wrap.className = 'avatar-wrap';
        wrap.setAttribute('data-tier', p.tier);
        wrap.setAttribute('data-progress', String(Math.min(100, p.streak % 100)));
        wrap.setAttribute('data-base', p.avatarSrc);
        if (p.badge) wrap.setAttribute('data-badge', p.badge);
        wrap.setAttribute('data-dot', '');

        // Inner meta
        const meta = document.createElement('div'); meta.className = 'meta';
        const name = document.createElement('div'); name.className = 'name'; name.textContent = p.name;
        const sub = document.createElement('div'); sub.className = 'sub';
        sub.innerHTML = `Tier: ${p.tier} · XP: ${p.xp.toLocaleString()} · Streak: ${p.streak}`;
        const rank = document.createElement('div'); rank.className = 'rank'; rank.textContent = '#' + p.rank;

        // XP bar
        const xpBar = document.createElement('div'); xpBar.className = 'xp-bar';
        const xpFill = document.createElement('div'); xpFill.className = 'xp-fill';
        xpFill.style.width = `${Math.min(100, (p.xp % 10000)/100)}%`;
        xpBar.appendChild(xpFill);

        meta.appendChild(name);
        meta.appendChild(sub);
        meta.appendChild(xpBar);

        card.appendChild(wrap);
        card.appendChild(meta);
        card.appendChild(rank);
        grid.appendChild(card);

        // Render avatar layers
        renderAvatar(wrap, {
          tier: p.tier,
          progress: Math.min(100, p.streak % 100),
          badge: p.badge || null,
          baseSrc: p.avatarSrc,
          showDot: true
        });
      });
    }
  </script>
</body>
</html>
