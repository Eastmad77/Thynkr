<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daily Challenge â€” Whylee</title>

  <link rel="stylesheet" href="/styles/brand.css?v=8000">
  <link rel="stylesheet" href="/styles/style.css?v=8000">
  <link rel="stylesheet" href="/styles/animations.css?v=8000">

  <style>
    .stage { width:min(980px,94%); margin:2rem auto; background:var(--whylee-panel); border:1px solid var(--whylee-edge); border-radius:16px; padding:1.25rem; }
    .hud { display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1rem; }
    .q-card { background:var(--whylee-surface); border:1px solid var(--whylee-edge); border-radius:14px; padding:1rem; margin-bottom:1rem; }
    .answers { display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
    .answers button { padding:.9rem 1rem; text-align:left; border-radius:12px; border:1px solid var(--whylee-edge); background:#0b1120; color:var(--whylee-text); }
    .answers button:hover { background:#0e1530; }
    .end { text-align:center; padding:2rem; }
    .muted { color: var(--whylee-text-muted); }
    @media (max-width:720px){ .answers { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header class="app-header">
    <h1>Daily Challenge</h1>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/leaderboard.html">Leaderboard</a>
      <a href="/profile.html">Profile</a>
    </nav>
  </header>

  <main class="stage">
    <div class="hud">
      <div>Question <span id="qIdx">1</span>/<span id="qTotal">5</span></div>
      <div>Time: <span id="timer">0</span>s</div>
      <div>Score: <span id="score">0</span></div>
    </div>

    <section id="view" class="q-card" aria-live="polite"></section>
    <div id="controls" class="hud" style="justify-content:flex-end;">
      <button id="nextBtn" class="btn">Next</button>
      <button id="finishBtn" class="btn-pro" style="display:none;">Finish</button>
    </div>
  </main>

  <footer><small>Â© 2025 Whylee</small></footer>

  <script type="module">
    import { initCloudSync, addSessionResult } from "/scripts/auth/cloudsync.js?v=8000";
    import { initTheme } from "/scripts/theme/theme.js?v=8000";
    import { auth } from "/scripts/firebase-bridge.js?v=8000";

    initCloudSync(); initTheme();

    // --- Demo question set (replace with QuestionEngine/remote later)
    const QUESTIONS = [
      { q:"Which animal is Whyleeâ€™s mascot?", a:["Fox","Owl","Panda","Cat"], correct:0 },
      { q:"Best time for daily focus?", a:["Random","Consistent slot","Never","Late only"], correct:1 },
      { q:"What does XP represent?", a:["Luck","Effort over time","Speed only","Nothing"], correct:1 },
      { q:"Pro getsâ€¦", a:["Fewer badges","Bonus rounds","No avatars","Slower sync"], correct:1 },
      { q:"Whylee theme color?", a:["Neon pink","Deep blue","Lime only","Orange"], correct:1 }
    ];

    // --- State
    let idx = 0, score = 0;
    const startedAt = performance.now();

    // --- El refs
    const qIdx = document.getElementById('qIdx');
    const qTotal = document.getElementById('qTotal');
    const timerEl = document.getElementById('timer');
    const scoreEl = document.getElementById('score');
    const view = document.getElementById('view');
    const nextBtn = document.getElementById('nextBtn');
    const finishBtn = document.getElementById('finishBtn');

    qTotal.textContent = QUESTIONS.length;

    // timer
    let t0 = Date.now();
    setInterval(() => { timerEl.textContent = Math.floor((Date.now() - t0)/1000); }, 1000);

    function renderQuestion(i){
      const { q, a } = QUESTIONS[i];
      qIdx.textContent = i+1;
      view.innerHTML = `
        <h2 style="margin:.25rem 0 1rem;">${q}</h2>
        <div class="answers">
          ${a.map((opt, n)=>`<button data-n="${n}">${opt}</button>`).join("")}
        </div>
        <div class="muted" style="margin-top:.5rem;">Pick one answer</div>
      `;

      view.querySelectorAll("button[data-n]").forEach(btn=>{
        btn.addEventListener("click", () => {
          const guess = Number(btn.getAttribute("data-n"));
          if (guess === QUESTIONS[i].correct) { score += 1; scoreEl.textContent = score; }
          [...view.querySelectorAll("button[data-n]")].forEach(b=> b.disabled = true);
        });
      });

      nextBtn.style.display = (i < QUESTIONS.length - 1) ? "" : "none";
      finishBtn.style.display = (i === QUESTIONS.length - 1) ? "" : "none";
    }

    nextBtn.addEventListener('click', () => {
      if (idx < QUESTIONS.length - 1) {
        idx += 1;
        renderQuestion(idx);
      }
    });

    finishBtn.addEventListener('click', async () => {
      const durationMs = performance.now() - startedAt;
      const total = QUESTIONS.length;
      try {
        if (!auth.currentUser) {
          alert("Please sign in to save your score.");
          window.location.href = "/auth.html";
          return;
        }
        await addSessionResult({
          correct: score,
          total,
          durationMs,
          mode: "daily"
        });
        view.innerHTML = `
          <div class="end">
            <h2>Great work! ðŸŽ‰</h2>
            <p class="muted">You answered <strong>${score}/${total}</strong> correctly in <strong>${Math.round(durationMs/1000)}s</strong>.</p>
            <div style="margin-top:1rem;">
              <a class="btn" href="/leaderboard.html">View Leaderboard</a>
              <a class="btn-pro" href="/pro.html" style="margin-left:.5rem;">Get Bonus Rounds</a>
            </div>
          </div>
        `;
        document.getElementById('controls').style.display = "none";
      } catch (e) {
        alert(e.message || "Could not save results.");
      }
    });

    // init
    renderQuestion(idx);
  </script>
</body>
</html>
