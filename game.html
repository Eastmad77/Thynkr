<script type="module">
  import { initCloudSync, addSessionResult } from "/scripts/auth/cloudsync.js?v=8000";
  import { initTheme } from "/scripts/theme/theme.js?v=8000";
  import { auth } from "/scripts/firebase-bridge.js?v=8000";
  import { initQuestionEngine } from "/scripts/ai/questionEngine.js?v=8000";

  initCloudSync(); initTheme();

  const eng = await initQuestionEngine({ mode: "daily", count: 5 });
  let current = eng.next();

  function render(q) {
    // ... render like your existing scaffold (q.q, q.choices, q.correctIndex hidden)
  }

  function onSubmit(guessIndex, timeMs) {
    eng.submit(guessIndex, timeMs);
    if (eng.isComplete()) {
      const r = eng.results({ pro: /* read from user doc if needed */ false });
      await addSessionResult({
        correct: r.correct,
        total: r.total,
        durationMs: r.durationMs,
        mode: r.mode,
        xpEarned: r.xpEarned // optional; server will recompute
      });
      // ... show summary screen
    } else {
      current = eng.next();
      render(current);
    }
  }

  render(current);
</script>
